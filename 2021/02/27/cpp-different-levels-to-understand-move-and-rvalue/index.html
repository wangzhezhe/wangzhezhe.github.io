<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>cpp different levels to understand move and rvalue | AverageMind</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Concepts about move rvalue and forward etc, in cpp seems important and ambiguous for the most of the people, we try to understand thoese concepts in different levels.">
<meta property="og:type" content="article">
<meta property="og:title" content="cpp different levels to understand move and rvalue">
<meta property="og:url" content="http://yoursite.com/2021/02/27/cpp-different-levels-to-understand-move-and-rvalue/index.html">
<meta property="og:site_name" content="AverageMind">
<meta property="og:description" content="Concepts about move rvalue and forward etc, in cpp seems important and ambiguous for the most of the people, we try to understand thoese concepts in different levels.">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-03-13T10:57:41.008Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cpp different levels to understand move and rvalue">
<meta name="twitter:description" content="Concepts about move rvalue and forward etc, in cpp seems important and ambiguous for the most of the people, we try to understand thoese concepts in different levels.">
  
    <link rel="alternate" href="/atom.xml" title="AverageMind" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-165927341-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">AverageMind</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Writing is nature&#39;s way of letting you know how sloppy your thinking is.</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-cpp-different-levels-to-understand-move-and-rvalue" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/02/27/cpp-different-levels-to-understand-move-and-rvalue/" class="article-date">
  <time datetime="2021-02-28T03:44:53.000Z" itemprop="datePublished">2021-02-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/c-c/">c/c++</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      cpp different levels to understand move and rvalue
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>Concepts about <code>move</code> <code>rvalue</code> and <code>forward</code> etc, in cpp seems important and ambiguous for the most of the people, we try to understand thoese concepts in different levels.</p>
<a id="more"></a>
<h3 id="if-we-can-take-the-addresses"><a href="#if-we-can-take-the-addresses" class="headerlink" title="if we can take the addresses"></a>if we can take the addresses</h3><p>Although there are lots of types such as <code>lvalue</code> <code>rvalue</code> <code>xvalue</code> <code>prvalues</code> etc, refer to <a href="https://stackoverflow.com/questions/3601602/what-are-rvalues-lvalues-xvalues-glvalues-and-prvalues" target="_blank" rel="noopener">this</a>, we start from the general lvalue and rvalue.</p>
<p>Simply speaking, the value that we can take address is the lvalue (it is on the left side of the expression), the value that we can not take it’s address is an rvalue (it is on the right side of the expression).</p>
<p>How do we express that object in the parameter list of the fuction call? For the <code>lvalue</code>, we can use pointer to the original object or the reference like this <code>TypeName &amp;</code>. In particular, if X is any type, then <code>X&amp;&amp;</code> is called an rvalue reference to X. For better distinction, the ordinary reference <code>X&amp;</code> is now also called an lvalue reference.</p>
<h3 id="basic-move-semantic"><a href="#basic-move-semantic" class="headerlink" title="basic move semantic"></a>basic move semantic</h3><p>The <code>std::move</code> function did not move anything, it just cast the varaible into the rvalue. Simply speaking by code, when there is a vector 1 and we want to get vector 2 from vector 1. Instead of using explicit copy, we can get the inner data of the vector 1, and cast it into an rvalue and assigne it to the vector 2. By this way, the vector 2 is responsible for the inner data. It looks that the inner data is moved from the vector 1 into the vector 2, but actually, we did not copy anything, just change the ownership of the inner value. It might be convenint to consider the vector as an container and we move inner object back and forth logically.</p>
<p>This is the sample code to show what we described:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line"></span><br><span class="line">void print(const std::vector&lt;int&gt;&amp; vec) &#123;</span><br><span class="line">  for (auto&amp;&amp; val : vec) &#123;</span><br><span class="line">    std::cout &lt;&lt; val &lt;&lt; &quot;, &quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">int main() &#123;</span><br><span class="line">  // initialize vec1 with 1, 2, 3, 4 and vec2 as an empty vector</span><br><span class="line">  std::vector&lt;int&gt; vec1&#123;1, 2, 3, 4&#125;;</span><br><span class="line">  std::vector&lt;int&gt; vec2;</span><br><span class="line">  // The following line will print 1, 2, 3, 4</span><br><span class="line">  print(vec1);</span><br><span class="line">  // The following line will print a new line</span><br><span class="line">  // nothing here for the vec2</span><br><span class="line">  print(vec2);</span><br><span class="line">  // The vector vec2 is assigned with move assingment.</span><br><span class="line">  // This will &quot;steal&quot; the value of vec1 without copying it.</span><br><span class="line">  vec2 = std::move(vec1);</span><br><span class="line">  // Here the vec1 object is in an indeterminate state, but still valid.</span><br><span class="line">  // The object vec1 is not destroyed,</span><br><span class="line">  // but there&apos;s is no guarantees about what it contains.</span><br><span class="line">  // The following line will print 1, 2, 3, 4</span><br><span class="line">  print(vec2);</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; &quot;vec1 size &quot; &lt;&lt; vec1.size() &lt;&lt; std::endl;</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">output</span><br><span class="line">1, 2, 3, 4, </span><br><span class="line"></span><br><span class="line">1, 2, 3, 4, </span><br><span class="line">vec1 size 0</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>the compiler optimization for the return value</p>
<p>for this sample code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">struct Test &#123;</span><br><span class="line">  Test() &#123; std::cout &lt;&lt; &quot;construct&quot; &lt;&lt; std::endl; &#125;</span><br><span class="line">  double a = 0;</span><br><span class="line">  // destructor</span><br><span class="line">  ~Test() &#123; std::cout &lt;&lt; &quot;destroy a is &quot; &lt;&lt; this-&gt;a &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Test getTest() &#123;</span><br><span class="line">  Test t;</span><br><span class="line">  t.a = 123;</span><br><span class="line">  return t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">  Test t = getTest();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">output</span><br><span class="line">construct</span><br><span class="line">destroy a is 123</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>the constructor is called only once, so we could make sure there is the optimization about the construction of the return value. This means that it is ok to return an struct and assing it to the new variable without worrying that this data structure is created twice.</p>
<h3 id="the-move-constructor-may-still-call-the-copy-constructor"><a href="#the-move-constructor-may-still-call-the-copy-constructor" class="headerlink" title="the move constructor may still call the copy constructor"></a>the move constructor may still call the copy constructor</h3><p>const case</p>
<h3 id="references"><a href="#references" class="headerlink" title="references"></a>references</h3><p>good thing<br><a href="http://thbecker.net/articles/rvalue_references/section_03.html" target="_blank" rel="noopener">http://thbecker.net/articles/rvalue_references/section_03.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2021/02/27/cpp-different-levels-to-understand-move-and-rvalue/" data-id="cknxb32m2001nbss6wc606i43" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2021/03/09/Live-story/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Live story
        
      </div>
    </a>
  
  
    <a href="/2021/02/21/cpp-inheritance-tips/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">cpp inheritance tips</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#if-we-can-take-the-addresses"><span class="toc-number">1.</span> <span class="toc-text">if we can take the addresses</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#basic-move-semantic"><span class="toc-number">2.</span> <span class="toc-text">basic move semantic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-move-constructor-may-still-call-the-copy-constructor"><span class="toc-number">3.</span> <span class="toc-text">the move constructor may still call the copy constructor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#references"><span class="toc-number">4.</span> <span class="toc-text">references</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2021 zhe&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;godenwangzhe@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>